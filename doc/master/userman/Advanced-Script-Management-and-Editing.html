---
layout: doc
title: Documentation
---

<div class="header">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="/doc/master/userman/Basic-Script-Management#Basic-Script-Management" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/Unicode-symbols-and-special-layout-support#Unicode-symbols-and-special-layout-support" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/index#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/ProofGeneral_toc#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/Function-Index#Function-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/ProofGeneral_abt#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
</div>

<hr size="2">
<a class="anchor" id="Advanced-Script-Management-and-Editing"></a>
<a class="anchor" id="Advanced-Script-Management-and-Editing-1"></a>
<h1 class="chapter">3. Advanced Script Management and Editing</h1>
<a class="anchor" id="index-Multiple-Files"></a>

<p>If you are working with large proof developments, you may want to know
about the advanced script management and editing features of Proof
General covered in this chapter.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Document-centred-working">3.1 Document centred working</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Automatic-processing">3.2 Automatic processing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Visibility-of-completed-proofs">3.3 Visibility of completed proofs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Switching-between-proof-scripts">3.4 Switching between proof scripts</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
<tr><td align="left" valign="top"><a href="#View-of-processed-files">3.5 View of processed files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">    
</td></tr>
<tr><td align="left" valign="top"><a href="#Retracting-across-files">3.6 Retracting across files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">     
</td></tr>
<tr><td align="left" valign="top"><a href="#Asserting-across-files">3.7 Asserting across files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">      
</td></tr>
<tr><td align="left" valign="top"><a href="#Proof-status-statistic">3.8 Proof status statistic</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Automatic-multiple-file-handling">3.9 Automatic multiple file handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Escaping-script-management">3.10 Escaping script management</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Editing-features">3.11 Editing features</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a class="anchor" id="Document-centred-working"></a>
<a class="anchor" id="Document-centred-working-1"></a>
<h2 class="section">3.1 Document centred working</h2>
<a class="anchor" id="index-annotation"></a>

<p>Proof scripts can be annotated with the output produced by the prover
while they are checked.  By hovering the mouse on the completed
regions you can see any output that was produced when they were
checked.  Depending on the proof language (it works well with
declarative languages), this may enable a &ldquo;document centred&rdquo; way of
working, where you may not need to keep a separate window open for
displaying prover output.
</p>
<p>This way of working is controlled by several settings.  To help
configure things appropriately for document-centred working, there are
two short-cut commands:
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Display -&gt; Document Centred 
Proof-General -&gt; Quick Options -&gt; Display -&gt; Default
</pre></td></tr></table>
<p>which change settings appropriately between a document centred
mode and the original classic Proof General behaviour and appearance.  
The first command also engages automatic processing of the whole
buffer, explained in the following section further below.
</p>
<p>The behaviour can be fine-tuned with the individual settings.
Starting with the classic settings, first, you may select
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Processing -&gt; Full Annotations
</pre></td></tr></table>
<p>to ensure that the details are recorded in the script.  This is not the
default because it can cause long sequences of commands to execute more
slowly as the output is collected from the prover eagerly when the
commands are executed, and printing can be be slow for large and complex
expressions.  It also increases the space requirements for Emacs
buffers.  However, when interactively developing smaller files, it is
very useful.
</p>
<p>Next, you may <i>de</i>select 
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Display -&gt; Auto Raise
</pre></td></tr></table>
<p>which will prevent the prover output being eagerly displayed.  You can
still manually arrange your Emacs windows and frames to ensure the
output buffers are present if you want.  
</p>
<p>You may like to <i>de</i>select
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof General -&gt; Quick Options -&gt; Display -&gt; Colour Locked
</pre></td></tr></table>
<p>to prevent highlighting of the locked region.  This text which
has been checked and that which has not is less obvious, but 
you can see the position of the next command to be processed
with the marker.
</p>
<p>If you have no colouring on the locked region, it can be hard to see
where processing has got to.  Look for the &ldquo;overlay marker&rdquo;, a triangle
in the left-hand fringe of the display, to see which line processing has
stopped at.   If it has stopped on a region with
an error, you might want to see that.  You can select
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Display -&gt; Sticky Errors
</pre></td></tr></table>
<p>to add a highlight for regions which did not successfully process
on the last attempt.  Whenever the region is edited, the
highlight is removed. 
</p>
<p>Finally, you may want to ensure that
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Read Only -&gt; Undo On Edit
</pre></td></tr></table>
<p>is selected.  
Undo on edit is a setting for the <code>proof-strict-read-only</code> variable.
This allows you to freely edit the processed region, but first it
automatically retracts back to the point of the edit.  Comments can
be edited freely without retraction.
</p>
<p>The configuration variables controlled by the above menu items can be
customized as Emacs variables.  The two settings which control
interaction with the prover are <code>proof-full-annotation</code> and
<code>proof-strict-read-only</code>.  Note that you can also record the
history of output from the prover <i>without</i> adding mouse hovers to the
script.  This is controlled by <code>proof-output-tooltips</code> which is
also on the Display menu in Quick Options.  See section <a href="/doc/master/userman/Customizing-Proof-General#Display-customization">Display customization</a>, for more information about customizing display options.
</p>
<dl>
<dt><a class="anchor" id="index-proof_002dfull_002dannotation"></a><u>User Option:</u> <b>proof-full-annotation</b></dt>
<dd><p>Non-nil causes Proof General to record output for all proof commands.<br>
Proof output is recorded as it occurs interactively; normally if
many steps are taken at once, this output is suppressed.  If this
setting is used to enable it, the proof script can be annotated
with full details.  See also &lsquo;<samp><code>proof-output-tooltips</code></samp>&rsquo; to enable
automatic display of output on mouse hovers.
</p>
<p>The default value is <code>nil</code>.
</p></dd></dl>


<dl>
<dt><a class="anchor" id="index-proof_002dstrict_002dread_002donly"></a><u>User Option:</u> <b>proof-strict-read-only</b></dt>
<dd><p>Whether Proof General is strict about the read-only region in buffers.<br>
If non-nil, an error is given when an attempt is made to edit the
read-only region, except for the special value <code>'retract</code> which means
undo first.  If nil, Proof General is more relaxed (but may give
you a reprimand!).
</p>
<p>The default value is <code>retract</code>.
</p></dd></dl>




<hr size="6">
<a class="anchor" id="Automatic-processing"></a>
<a class="anchor" id="Automatic-processing-1"></a>
<h2 class="section">3.2 Automatic processing</h2>
<a class="anchor" id="index-Automatic-processing"></a>
<a class="anchor" id="index-autosend"></a>
<a class="anchor" id="index-proof_002dautosend_002denable"></a>


<p>If you like making your hair stand on end, the electric
terminator mode is probably not enough.  Proof General has another
feature that will automatically send text to the prover, while
you aren&rsquo;t looking.
</p>
<p>Enabling
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Processing -&gt; Process Automatically
</pre></td></tr></table>

<p>Causes Proof General to start processing text when Emacs is idle for a
while.  You can choose either to send just the next command beyond the
point, or the whole buffer.  See
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">Proof-General -&gt; Quick Options -&gt; Processing -&gt; Automatic Processing Mode
</pre></td></tr></table>
<p>for the choices.
</p>
<p>The text will be sent in a fast loop that processes more quickly than
<kbd>C-c C-b</kbd> (i.e., <code>proof-process-buffer</code>, the down toolbar
button), but ignores user input and doesn&rsquo;t update the display.  But the
feature tries to be non-intrusive to the user: if you start to type
something or use the mouse, the fast loop will be interrupted and revert
to a slower interactive loop with display updates.
</p>
<p>In the check next command mode, the successfully checked region will
briefly flash up as green to indicate it is okay.
</p>
<p>You can use <kbd>C-c C-.</kbd> (<code>proof-goto-end-of-locked</code>) to find out
where processing got to, as usual.  Text is only sent if the last
interactive command processed some text (i.e., wasn&rsquo;t an undo step
backwards into the buffer) and processing didn&rsquo;t stop with an error.  To
start automatic processing again after an error, simply hit <kbd>C-c
C-n</kbd> after editing the buffer.  To turn the automatic processing on or
off from the keyboard, you can use the key binding:
</p>
<dl compact="compact">
<dt> <kbd>C-c &gt;</kbd></dt>
<dd><p><code>proof-autosend-toggle</code>
</p></dd>
</dl>

<dl>
<dt><a class="anchor" id="index-proof_002dautosend_002dtoggle"></a><u>Command:</u> <b>proof-autosend-toggle</b><i> &amp;optional arg</i></dt>
<dd><p>Toggle &lsquo;<samp><code>proof-autosend-enable</code></samp>&rsquo;. With <var>arg</var>, turn on iff ARG&gt;0.<br>
This function simply uses <code>customize-set-variable</code> to set the variable.
</p></dd></dl>


<hr size="6">
<a class="anchor" id="Visibility-of-completed-proofs"></a>
<a class="anchor" id="Visibility-of-completed-proofs-1"></a>
<h2 class="section">3.3 Visibility of completed proofs</h2>
<a class="anchor" id="index-Visibility-of-proofs"></a>

<p>Large developments may consist of large files with many proofs.  To help
see what has been proved without the detail of the proof itself, Proof
General can hide portions of the proof script.  Two different kinds of
thing can be hidden: comments and (what Proof General designates as) the
body of proofs.
</p>
<p>You can toggle the visibility of a proof script portion by using the
context sensitive menu triggered by <b>clicking the right mouse button
on a completed proof</b>, or the key <kbd>C-c v</kbd>, which runs
<code>pg-toggle-visibility</code>.
</p>
<p>You can also select the &ldquo;disappearing proofs&rdquo; mode from the menu,
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">  Proof-General -&gt; Quick Options -&gt; Display -&gt; Disappearing Proofs
</pre></td></tr></table>

<p>This automatically hides each the body of each proof portion
as it is completed by the proof assistant.
Two further menu commands in the main Proof-General menu,
<em>Show all</em> and <em>Hide all</em> apply to all the completed
portions in the buffer.
</p>
<p>Notice that by design, this feature only applies to completed proofs,
<em>after</em> they have been processed by the proof assistant.  When
files are first visited in Proof General, no information is stored about
proof boundaries.
</p>
<p>The relevant elisp functions and settings are mentioned below.
</p>
<dl>
<dt><a class="anchor" id="index-pg_002dtoggle_002dvisibility"></a><u>Command:</u> <b>pg-toggle-visibility</b></dt>
<dd><p>Toggle visibility of region under point.
</p></dd></dl>

<dl>
<dt><a class="anchor" id="index-pg_002dshow_002dall_002dproofs"></a><u>Command:</u> <b>pg-show-all-proofs</b></dt>
<dd><p>Display all completed proofs in the buffer.
</p></dd></dl>

<dl>
<dt><a class="anchor" id="index-pg_002dhide_002dall_002dproofs"></a><u>Command:</u> <b>pg-hide-all-proofs</b></dt>
<dd><p>Hide all completed proofs in the buffer.
</p></dd></dl>

<dl>
<dt><a class="anchor" id="index-proof_002ddisappearing_002dproofs"></a><u>User Option:</u> <b>proof-disappearing-proofs</b></dt>
<dd><p>Non-nil causes Proof General to hide proofs as they are completed.
</p>
<p>The default value is <code>nil</code>.
</p></dd></dl>


<hr size="6">
<a class="anchor" id="Switching-between-proof-scripts"></a>
<a class="anchor" id="Switching-between-proof-scripts-1"></a>
<h2 class="section">3.4 Switching between proof scripts</h2>
<a class="anchor" id="index-Switching-between-proof-scripts"></a>

<p>Basic modularity in large proof developments can be achieved by
splitting proof scripts across various files. Let&rsquo;s assume that you are
in the middle of a proof development. You are working on a soundness
proof of Hoare Logic in a file called<a id="DOCF5" href="/doc/master/userman/ProofGeneral_fot#FOOT5">(5)</a> &lsquo;<tt>HSound.v</tt>&rsquo;. It
depends on a number of other files which develop underlying
concepts e.g. syntax and semantics of expressions, assertions,
imperative programs. You notice that the current lemma is too difficult
to prove because you have forgotten to prove some more basic properties
about determinism of the programming language. Or perhaps a previous
definition is too cumbersome or even wrong.
</p>
<p>At this stage, you would like to visit the appropriate file, say
&lsquo;<tt>sos.v</tt>&rsquo; and retract to where changes are required. Then, using
script management, you want to develop some more basic theory in
&lsquo;<tt>sos.v</tt>&rsquo;. Once this task has been completed (possibly involving
retraction across even earlier files) and the new development has been
asserted, you want to switch back to &lsquo;<tt>HSound.v</tt>&rsquo; and replay to the
point you got stuck previously.
</p>
<p>Some hours (or days) later you have completed the soundness proof and
are ready to tackle new challenges. Perhaps, you want to prove a
property that builds on soundness or you want to prove an orthogonal
property such as completeness.
</p>
<p>Proof General lets you do all of this while maintaining the consistency
between proof script buffers and the state of the proof assistant.
However, you cannot have more than one buffer where only a fraction of
the proof script contains a locked region. Before you can employ script
management in  another proof script buffer, you must either fully assert
or retract the current script buffer.
</p>
<hr size="6">
<a class="anchor" id="View-of-processed-files"></a>
<a class="anchor" id="View-of-processed-files-1"></a>
<h2 class="section">3.5 View of processed files</h2>

<p>Proof General tries to be aware of all files that the proof assistant
has processed or is currently processing.  In the best case, it relies
on the proof assistant explicitly telling it whenever it processes a new
file which corresponds<a id="DOCF6" href="/doc/master/userman/ProofGeneral_fot#FOOT6">(6)</a> to a file
containing a proof script.
</p>
<p>If the current proof script buffer depends on background material from
other files, proof assistants typically process these files
automatically. If you visit such a file, the whole file is locked as
having been processed in a single step.  From the user&rsquo;s point of view,
you can only retract but not assert in this buffer. Furthermore,
retraction is only possible to the <em>beginning</em> of the buffer.
</p>
<p>Unlike a script buffer that has been processed step-by-step via Proof
General, automatically loaded script buffers do not pass through a
&ldquo;red&rdquo; phase to indicate that they are currently being processed.  This
is a limitation of the present implementation.  Proof General locks a
buffer as soon as it sees the appropriate message from the proof
assistant.  Different proof assistants may use different messages:
either <em>early locking</em> when processing a file begins (e.g. LEGO) or
<em>late locking</em> when processing a file ends (e.g. Isabelle).
</p>
<p>With <em>early locking</em>, you may find that a script which has only
been partly processed (due to an error or interrupt, for example), is
wrongly completely locked by Proof General.  Visit the file and retract
back to the start to fix this.
</p>
<p>With <em>late locking</em>, there is the chance that you can break
synchronization by editing a file as it is being read by the proof
assistant, and saving it before processing finishes.
</p>
<p>In fact, there is a general problem of editing files which may be
processed by the proof assistant automatically.  Synchronization can be
broken whenever you have unsaved changes in a proof script buffer and
the proof assistant processes the corresponding file.  (Of course, this
problem is familiar from program development using separate editors
and compilers).  The good news is that Proof General can detect the
problem and flashes up a warning in the response buffer.  You can then
visit the modified buffer, save it and retract to the beginning. Then
you are back on track.
</p>


<hr size="6">
<a class="anchor" id="Retracting-across-files"></a>
<a class="anchor" id="Retracting-across-files-1"></a>
<h2 class="section">3.6 Retracting across files</h2>
<a class="anchor" id="index-Retraction-1"></a>

<p>Make sure that the current script buffer has either been completely
asserted or retracted (Proof General enforces this).  Then you can
retract proof scripts in a different file. Simply visit a file that has
been processed earlier and retract in it, using the retraction commands
from see section <a href="/doc/master/userman/Basic-Script-Management#Script-processing-commands">Script processing commands</a>. Apart from removing parts of the
locked region in this buffer, all files which depend on it will be
retracted (and thus unlocked) automatically. Proof General reminds you
that now is a good time to save any unmodified buffers.
</p>
<hr size="6">
<a class="anchor" id="Asserting-across-files"></a>
<a class="anchor" id="Asserting-across-files-1"></a>
<h2 class="section">3.7 Asserting across files</h2>
<a class="anchor" id="index-Assertion-1"></a>

<p>Make sure that the current script buffer has either been completely
asserted or retracted. Then you can assert proof scripts in a different
file. Simply visit a file that contains no locked region and assert some
command with the usual assertion commands, see section <a href="/doc/master/userman/Basic-Script-Management#Script-processing-commands">Script processing commands</a>. Proof General reminds you that now is a good time to save any
unmodified buffers.  This is particularly useful as assertion may cause
the proof assistant to automatically process other files.
</p>

<hr size="6">
<a class="anchor" id="Proof-status-statistic"></a>
<a class="anchor" id="Proof-status-statistic-1"></a>
<h2 class="section">3.8 Proof status statistic</h2>
<a class="anchor" id="index-Proof-status-statistic"></a>

<p>The command <code>proof-check-report</code> (menu <code>Proof-General -&gt;
Check Opaque Proofs</code>) generates the proof status of all opaque proofs
in the current buffer, i.e., it generates an overview that shows which
of the opaque proofs in the current buffer are currently valid and
which are failing. When used interactively, the proof status is shown
in the buffer <code>*proof-check-report*</code> (as long as
<code>proof-check-report-buffer</code> is not changed). Note that incomplete
proofs, i.e., Admitted proofs for Coq, count as invalid.
</p>
<p>The command <code>proof-check-annotate</code> (menu <code>Proof-General -&gt;
Annotate Failing Proofs</code>) modifies the current buffer and places
comments containing <code>FAIL</code> on all failing opaque proofs. With
prefix argument also the passing proofs are annotated with
<code>PASS</code>. For configuring the position of these comments, see
<code>proof-check-annotate-position</code> and
<code>proof-check-annotate-right-margin</code>.
</p>
<p>Currently <code>proof-check-report</code> and <code>proof-check-annotate</code>
only work for Coq.
</p>
<dl>
<dt><a class="anchor" id="index-proof_002dcheck_002dreport"></a><u>Command:</u> <b>proof-check-report</b><i> tap &amp;optional batch</i></dt>
<dd><p>Generate an overview about valid and invalid proofs.<br>
This command completely processes the current buffer and
generates an overview about all the opaque proofs in it and
whether their proof scripts are valid or invalid. Note that
proofs closed with a cheating command (see
&lsquo;<samp><code>proof-omit-cheating-regexp</code></samp>&rsquo;), i.e., Admitted for Coq, count as
invalid.
</p>
<p>This command makes sense for a development process where invalid
proofs are permitted and vos compilation and the omit proofs
feature (see &lsquo;<samp><code>proof-omit-proofs-configured</code></samp>&rsquo;) are used to work at
the most interesting or challenging point instead of on the first
invalid proof.
</p>
<p>Argument <var>tap</var>, which can be set by a prefix argument, controls the
form of the generated overview. Nil, without prefix, gives an
human readable overview, otherwise it&rsquo;s test anything
protocol (<var>tap</var>). Argument <var>batch</var> controls where the overview goes
to. If nil, or in an interactive call, the overview appears in
&lsquo;<samp><code>proof-check-report-buffer</code></samp>&rsquo;. If <var>batch</var> is a string, it should be a
filename to write the overview to. Otherwise the overview is
output via &lsquo;<samp>message</samp>&rsquo; such that it appears on stdout when this
command runs in batch mode.
</p>
<p>In the same way as the omit-proofs feature, this command only
tolerates errors inside scripts of opaque proofs. Any other error
is reported to the user without generating an overview. The
overview only contains those names of theorems whose proof
scripts are classified as opaque by the omit-proofs feature. For
Coq for instance, among others, proof scripts terminated with
<code>'Defined'</code> are not opaque and do not appear in the generated
overview.
</p>
<p>Note that this command does not (re-)compile required files.
Dependencies must be compiled before running this commands, for
instance by asserting all require commands beforehand.
</p></dd></dl>

<dl>
<dt><a class="anchor" id="index-proof_002dcheck_002dannotate"></a><u>Command:</u> <b>proof-check-annotate</b><i> annotate-passing &amp;optional save-buffer</i></dt>
<dd><p>Annotate failing proofs in current buffer with a &quot;<var>fail</var>&quot; comment.<br>
This function modifies the current buffer in place. Use with
care!
</p>
<p>Similarly to &lsquo;<samp><code>proof-check-report</code></samp>&rsquo;, check all opaque proofs in the
current buffer. Instead of generating a report, failing proofs
are annotated with &quot;<var>fail</var>&quot; in a comment. Existing &quot;<var>pass</var>&quot; or
&quot;<var>fail</var>&quot; comments (e.g., from a previous run) are deleted
together with the surrounding white space. With prefix argument
(or when <var>annotate-passing</var> is non-nil) also passing proofs are
annotated with a &quot;<var>pass</var>&quot; comment. Pass and fail comments can be
placed at the last or second last statement before the opaque
proof. For Coq this corresponds to the proof using and the
theorem statement, respectively. In both cases the comment is
placed at the right margin of the first line, see
&lsquo;<samp><code>proof-check-annotate-position</code></samp>&rsquo; and
&lsquo;<samp><code>proof-check-annotate-right-margin</code></samp>&rsquo;.
</p>
<p>Interactively, this command does not save the current buffer
after placing the annotations. With <var>save-buffer</var> non-nil, the
current buffer is saved if it has been modified.
</p></dd></dl>

<dl>
<dt><a class="anchor" id="index-proof_002dcheck_002dannotate_002dposition"></a><u>Variable:</u> <b>proof-check-annotate-position</b></dt>
<dd><p>Line for annotating proofs with &quot;<var>pass</var>&quot; or &quot;<var>fail</var>&quot; comments.<br>
This option determines the line where &lsquo;<samp><code>proof-check-annotate</code></samp>&rsquo; puts
comments with &quot;<var>pass</var>&quot; and &quot;<var>fail</var>&quot;. Value &lsquo;&rsquo;theoren&rsquo; uses the
first line of the second last statement before the start of the
opaque proof, which corresponds to the line containing a Theorem
keyword for Coq. Value &lsquo;&rsquo;proof-using&rsquo; uses the first line of the
last statement before the opaque proof, which corresponds to the
Proof using line for Coq.
</p></dd></dl>

<dl>
<dt><a class="anchor" id="index-proof_002dcheck_002dannotate_002dright_002dmargin"></a><u>Variable:</u> <b>proof-check-annotate-right-margin</b></dt>
<dd><p>Right margin for &quot;<var>pass</var>&quot; and &quot;<var>fail</var>&quot; comments.<br>
This option determines the right margin to which
&lsquo;<samp><code>proof-check-annotate</code></samp>&rsquo; right-aligns the comments with &quot;<var>pass</var>&quot;
and &quot;<var>fail</var>&quot;. If nil, the value of &lsquo;<samp><code>fill-column</code></samp>&rsquo; is used.
</p></dd></dl>


<p>See section <a href="/doc/master/userman/Coq-Proof-General#Quick-and-inconsistent-compilation">Quick and inconsistent compilation</a> for enabling vos compilation
inside Proof General and see See section <a href="/doc/master/userman/Coq-Proof-General#Omitting-proofs-for-speed">Omitting proofs for speed</a> for the
omit-proofs feature.
</p>
<p>The interactive use of <code>proof-check-report</code> and
<code>proof-check-annotate</code> is limited because they only work on the
current buffer. However, these commands can also be run in batch mode
in a script, for instance in a continuous integration environment. To
run <code>proof-check-report</code> on a file in batch mode, use
</p>
<pre class="verbatim">emacs -batch -l &lt;your-pg-dir&gt;/generic/proof-site.el &lt;file&gt; \
      --eval '(proof-check-report &lt;tap&gt; &lt;output&gt;)'
</pre>
<p>where <code>&lt;tap&gt;</code> should be <code>nil</code> for human readable output and
<code>t</code> for test anything protocol. If <code>&lt;output&gt;</code> is <code>t</code>
the proof status appears in the standard output of the Emacs process.
Otherwise <code>&lt;output&gt;</code> should be a filename as string in double
quotes. Then the proof status is written to this file. (If
<code>output</code> is <code>nil</code> or omitted, the proof status is only put
into the <code>*proof-check-report*</code> buffer, which does not make much
sense in a batch command as the one above.)
</p>
<p>Using a similar command also <code>proof-check-annotate</code> can run in
batch mode in a continuous integration environment, for instance for
checking that all failing proofs are annotated with <code>FAIL</code>
via <code>git diff --exit-code</code>.
</p>

<hr size="6">
<a class="anchor" id="Automatic-multiple-file-handling"></a>
<a class="anchor" id="Automatic-multiple-file-handling-1"></a>
<h2 class="section">3.9 Automatic multiple file handling</h2>

<p>To make it easier to adapt Proof General for a proof assistant, there is
another possibility for multiple file support &mdash; that it is provided
automatically by Proof General and not integrated with the
file-management system of the proof assistant.
</p>
<p>In this case, Proof General assumes that the only files processed are
the ones it has sent to the proof assistant itself.  Moreover, it
(conservatively) assumes that there is a linear dependency between files
in the order they were processed.
</p>
<p>If you only have automatic multiple file handling, you&rsquo;ll find that any
files loaded directly by the proof assistant are <em>not</em> locked when
you visit them in Proof General.  Moreover, if you retract a file it may
retract more than is strictly necessary (because it assumes a linear
dependency).
</p>
<p>For further technical details of the ways multiple file scripting is
configured, see <i>Handling multiple files</i> in
the <i>Adapting Proof General</i> manual.
</p>


<hr size="6">
<a class="anchor" id="Escaping-script-management"></a>
<a class="anchor" id="Escaping-script-management-1"></a>
<h2 class="section">3.10 Escaping script management</h2>
<a class="anchor" id="index-Shell"></a>

<p>Occasionally you may want to review the dialogue of the entire session
with the proof assistant, or check that it hasn&rsquo;t done something
unexpected.  Experienced users may also want to directly communicate
with the proof assistant rather than sending commands via the
minibuffer, see section <a href="/doc/master/userman/Basic-Script-Management#Proof-assistant-commands">Proof assistant commands</a>.
</p>
<p>Although the proof shell is usually hidden from view, it is run in a
buffer which you can use to interact with the prover if necessary.  You
can switch to it using the menu:
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">  Proof-General -&gt; Buffers -&gt; Shell
</pre></td></tr></table>

<p><b>Warning:</b> you can probably cause confusion by typing in the shell
buffer!  Proof General may lose track of the state of the proof
assistant.  Output from the assistant is only fully monitored when Proof
General is in control of the shell.
When in control, Proof General watches the output from the proof
assistant to guess when a file is loaded or when a proof step is taken
or undone.  What happens when you type in the shell buffer directly
depends on how complete the communication is between Proof General and
the prover (which depends on the particular instantiation of Proof
General).
</p>
<p>If synchronization is lost, you have two options to resynchronize. If
you are lucky, it might suffice to use the key:
</p>
<dl compact="compact">
<dt> <kbd>C-c C-z</kbd></dt>
<dd><p><code>proof-frob-locked-end</code>
</p></dd>
</dl>

<p>This command is disabled by default, to protect novices using it
accidently.
</p>
<p>If <code>proof-frob-locked-end</code> does not work, you will need to restart
script management altogether (see section <a href="/doc/master/userman/Basic-Script-Management#Proof-assistant-commands">Proof assistant commands</a>).
</p>
<dl>
<dt><a class="anchor" id="index-proof_002dfrob_002dlocked_002dend"></a><u>Command:</u> <b>proof-frob-locked-end</b></dt>
<dd><p>Move the end of the locked region backwards to regain synchronization.<br>
Only for use by consenting adults.
</p>
<p>This command can be used to repair synchronization in case something
goes wrong and you want to tell Proof General that the proof assistant
has processed less of your script than Proof General thinks.
</p>
<p>You should only use it to move the locked region to the end of
a proof command.
</p></dd></dl>


<hr size="6">
<a class="anchor" id="Editing-features"></a>
<a class="anchor" id="Editing-features-1"></a>
<h2 class="section">3.11 Editing features</h2>
<a class="anchor" id="index-Input-ring"></a>

<p>To make editing proof scripts more productive, Proof General provides
some additional editing commands.
</p>
<p>One facility is the <i>input ring</i> of previously processed commands.
This allows a convenient way of repeating an earlier command or a small
edit of it.  The feature is reminiscent of history mechanisms provided
in shell terminals (and the implementation is borrowed from the Emacs
Comint package).  The input ring only contains commands which have been
successfully processed (coloured blue).  Duplicated commands are only
entered once.  
The size of the ring is set by the variable <code>pg-input-ring-size</code>.
</p>
<a class="anchor" id="index-M_002dp"></a>
<a class="anchor" id="index-M_002dn"></a>
<dl compact="compact">
<dt> <kbd>M-p</kbd></dt>
<dd><p><code>pg-previous-matching-input-from-input</code>
</p></dd>
<dt> <kbd>M-n</kbd></dt>
<dd><p><code>pg-next-matching-input-from-input</code>
</p></dd>
</dl>


<dl>
<dt><a class="anchor" id="index-pg_002dprevious_002dinput"></a><u>Command:</u> <b>pg-previous-input</b><i> arg</i></dt>
<dd><p>Cycle backwards through input history, saving input.<br>
If called interactively, <var>arg</var> is given by the prefix argument.
</p></dd></dl>
<dl>
<dt><a class="anchor" id="index-pg_002dnext_002dinput"></a><u>Command:</u> <b>pg-next-input</b><i> arg</i></dt>
<dd><p>Cycle forwards through input history.<br>
If called interactively, <var>arg</var> is given by the prefix argument.
</p></dd></dl>
<dl>
<dt><a class="anchor" id="index-pg_002dprevious_002dmatching_002dinput"></a><u>Command:</u> <b>pg-previous-matching-input</b><i> regexp n</i></dt>
<dd><p>Search backwards through input history for match for <var>regexp</var>.<br>
(Previous history elements are earlier commands.)
With prefix argument <var>n</var>, search for Nth previous match.
If <var>n</var> is negative, find the next or Nth next match.
</p></dd></dl>
<dl>
<dt><a class="anchor" id="index-pg_002dnext_002dmatching_002dinput"></a><u>Command:</u> <b>pg-next-matching-input</b><i> regexp n</i></dt>
<dd><p>Search forwards through input history for match for <var>regexp</var>.<br>
(Later history elements are more recent commands.)
With prefix argument <var>n</var>, search for Nth following match.
If <var>n</var> is negative, find the previous or Nth previous match.
</p></dd></dl>
<dl>
<dt><a class="anchor" id="index-pg_002dprevious_002dmatching_002dinput_002dfrom_002dinput"></a><u>Command:</u> <b>pg-previous-matching-input-from-input</b><i> n</i></dt>
<dd><p>Search backwards through input history for match for current input.<br>
(Previous history elements are earlier commands.)
With prefix argument <var>n</var>, search for Nth previous match.
If <var>n</var> is negative, search forwards for the -Nth following match.
</p></dd></dl>
<dl>
<dt><a class="anchor" id="index-pg_002dnext_002dmatching_002dinput_002dfrom_002dinput"></a><u>Command:</u> <b>pg-next-matching-input-from-input</b><i> n</i></dt>
<dd><p>Search forwards through input history for match for current input.<br>
(Following history elements are more recent commands.)
With prefix argument <var>n</var>, search for Nth following match.
If <var>n</var> is negative, search backwards for the -Nth previous match.
</p></dd></dl>


<hr size="6">
<div class="header">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Advanced-Script-Management-and-Editing" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/Unicode-symbols-and-special-layout-support#Unicode-symbols-and-special-layout-support" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/index#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/ProofGeneral_toc#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/Function-Index#Function-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="/doc/master/userman/ProofGeneral_abt#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
</div>
<p>
 <font size="-1">
  This document was generated on <i>January 25, 2025</i> using <a href="http://www.nongnu.org/texi2html/"><i>texi2html 1.82</i></a>.
 </font>
 <br>

</p>
